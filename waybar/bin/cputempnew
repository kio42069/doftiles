#!/usr/bin/env bash

check() {
    command -v "$1" 1>/dev/null
}

check sensors || exit

data="$(sensors k10temp-pci-00c3 | sed 's/+//g')"
package="$(echo "$data" | awk -e '/Tctl:/ {print $2}')"

if [ -z "$package" ]; then
    # Handle the case where "Package" temperature is not available
    echo '{"text":" N/A","tooltip":"<b>Core Temp: N/A</b>\n", "class": "unknown"}'
    exit
fi

tooltip="<b>Core Temp: $package </b>\n"

# "format-icons" : [ "", "", "", "", "" ] ,
tempint=${package%.*}
icon="$package "
class="cool"
[ "$tempint" -gt 50 ] && {
    icon="$package "
    class="normal"
}
[ "$tempint" -gt 70 ] && {
    icon="$package "
    class="warm"
}
[ "$tempint" -gt 85 ] && {
    icon="$package "
    class="warn"
}
[ "$tempint" -gt 95 ] && {
    icon="$package "
    class="critical"
}

# Since there is no "coretemp" variable, you can remove the loop related to core temperature

cat <<EOF
{"text":"$icon","tooltip":"$tooltip", "class": "$class"}

EOF
